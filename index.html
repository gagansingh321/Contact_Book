<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Book - MTM6407</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4.0.15/dist/vue-router.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
    <div id="app">
        <!-- Navigation -->
        <nav class="bg-indigo-600 shadow-lg text-white sticky top-0 z-50">
            <div class="max-w-4xl mx-auto px-4">
                <div class="flex justify-between items-center h-16">
                    <router-link to="/" class="font-bold text-xl flex items-center gap-2">
                        <i class="fa-solid fa-address-book"></i> ContactBook
                    </router-link>
                    <router-link to="/add" class="bg-white text-indigo-600 hover:bg-indigo-50 px-4 py-2 rounded-lg font-medium transition-colors text-sm shadow-sm">
                        <i class="fa-solid fa-plus mr-1"></i> New Contact
                    </router-link>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-4xl mx-auto px-4 py-8">
            <router-view v-slot="{ Component }">
                <transition name="fade" mode="out-in">
                    <component :is="Component" />
                </transition>
            </router-view>
        </main>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, reactive } = Vue;
        const { createRouter, createWebHashHistory, useRoute, useRouter } = VueRouter;

        // --- Mock Data & Store Logic (Simulating LocalStorage) ---
        const useContacts = () => {
            const contacts = ref([]);

            const loadContacts = () => {
                const stored = localStorage.getItem('mtm6407-contacts');
                if (stored) {
                    contacts.value = JSON.parse(stored);
                } else {
                    // Seed initial data if empty
                    contacts.value = [
                        { id: '1', firstName: 'Alice', lastName: 'Zann', email: 'alice@example.com', phone: '555-0101' },
                        { id: '2', firstName: 'Bob', lastName: 'Adams', email: 'bob@example.com', phone: '555-0102' },
                        { id: '3', firstName: 'Charlie', lastName: 'Brown', email: 'charlie@example.com', phone: '555-0103' }
                    ];
                    saveContacts();
                }
            };

            const saveContacts = () => {
                localStorage.setItem('mtm6407-contacts', JSON.stringify(contacts.value));
            };

            const addContact = (contact) => {
                const newContact = { ...contact, id: Date.now().toString() };
                contacts.value.push(newContact);
                saveContacts();
                return newContact.id;
            };

            const updateContact = (updatedContact) => {
                const index = contacts.value.findIndex(c => c.id === updatedContact.id);
                if (index !== -1) {
                    contacts.value[index] = updatedContact;
                    saveContacts();
                }
            };

            const deleteContact = (id) => {
                contacts.value = contacts.value.filter(c => c.id !== id);
                saveContacts();
            };

            const getContact = (id) => contacts.value.find(c => c.id === id);

            return { contacts, loadContacts, addContact, updateContact, deleteContact, getContact };
        };

        // --- Components ---

        // 1. Home View
        const Home = {
            setup() {
                const { contacts, loadContacts } = useContacts();
                const searchQuery = ref('');

                onMounted(() => loadContacts());

                const filteredContacts = computed(() => {
                    let result = contacts.value;
                    
                    // Filter
                    if (searchQuery.value) {
                        const q = searchQuery.value.toLowerCase();
                        result = result.filter(c => 
                            c.firstName.toLowerCase().includes(q) || 
                            c.lastName.toLowerCase().includes(q)
                        );
                    }

                    // Sort Alphabetically by Last Name
                    return result.sort((a, b) => a.lastName.localeCompare(b.lastName));
                });

                return { filteredContacts, searchQuery };
            },
            template: `
                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h1 class="text-2xl font-bold text-gray-800 mb-4">My Contacts</h1>
                        <div class="relative">
                            <i class="fa-solid fa-search absolute left-3 top-3 text-gray-400"></i>
                            <input 
                                v-model="searchQuery" 
                                type="text" 
                                placeholder="Search by name..." 
                                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all"
                            >
                        </div>
                    </div>

                    <div v-if="filteredContacts.length === 0" class="text-center py-12 bg-white rounded-xl shadow-sm">
                        <div class="text-gray-400 mb-2"><i class="fa-regular fa-folder-open text-4xl"></i></div>
                        <p class="text-gray-500">No contacts found.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <router-link 
                            v-for="contact in filteredContacts" 
                            :key="contact.id" 
                            :to="'/contact/' + contact.id"
                            class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 hover:shadow-md hover:border-indigo-200 transition-all cursor-pointer flex items-center justify-between group"
                        >
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold text-lg">
                                    {{ contact.firstName.charAt(0) }}{{ contact.lastName.charAt(0) }}
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800 group-hover:text-indigo-600 transition-colors">
                                        {{ contact.firstName }} {{ contact.lastName }}
                                    </h3>
                                    <p class="text-sm text-gray-500">{{ contact.email }}</p>
                                </div>
                            </div>
                            <i class="fa-solid fa-chevron-right text-gray-300 group-hover:text-indigo-400"></i>
                        </router-link>
                    </div>
                </div>
            `
        };

        // 2. Details View
        const ContactDetails = {
            setup() {
                const route = useRoute();
                const router = useRouter();
                const { contacts, loadContacts, deleteContact, getContact } = useContacts();
                const contact = ref(null);

                onMounted(() => {
                    loadContacts();
                    contact.value = getContact(route.params.id);
                    if (!contact.value) router.push('/');
                });

                const handleDelete = () => {
                    if(confirm('Are you sure you want to delete this contact?')) {
                        deleteContact(contact.value.id);
                        router.push('/');
                    }
                };

                return { contact, handleDelete };
            },
            template: `
                <div v-if="contact" class="max-w-2xl mx-auto">
                    <button @click="$router.push('/')" class="mb-4 text-sm text-gray-500 hover:text-indigo-600 flex items-center gap-1">
                        <i class="fa-solid fa-arrow-left"></i> Back to list
                    </button>
                    
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100">
                        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-8 text-center text-white">
                            <div class="w-24 h-24 mx-auto bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-3xl font-bold border-4 border-white/30 mb-4">
                                {{ contact.firstName.charAt(0) }}{{ contact.lastName.charAt(0) }}
                            </div>
                            <h2 class="text-3xl font-bold">{{ contact.firstName }} {{ contact.lastName }}</h2>
                            <p class="text-indigo-100 mt-1">Contact Details</p>
                        </div>

                        <div class="p-8 space-y-6">
                            <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                                    <i class="fa-solid fa-envelope"></i>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-400 uppercase tracking-wider font-semibold">Email</p>
                                    <p class="text-gray-800 font-medium break-all">{{ contact.email }}</p>
                                </div>
                            </div>

                            <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                                    <i class="fa-solid fa-phone"></i>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-400 uppercase tracking-wider font-semibold">Phone</p>
                                    <p class="text-gray-800 font-medium">{{ contact.phone || 'N/A' }}</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-6 flex gap-3 justify-end border-t border-gray-100">
                            <button @click="handleDelete" class="px-4 py-2 text-red-600 bg-white border border-red-100 hover:bg-red-50 rounded-lg font-medium transition-colors shadow-sm">
                                <i class="fa-solid fa-trash mr-1"></i> Delete
                            </button>
                            <router-link :to="'/edit/' + contact.id" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors shadow-sm shadow-indigo-200">
                                <i class="fa-solid fa-pen mr-1"></i> Edit
                            </router-link>
                        </div>
                    </div>
                </div>
            `
        };

        // 3. Form View (Used for both Add and Edit)
        const ContactForm = {
            props: ['isEdit'],
            setup(props) {
                const router = useRouter();
                const route = useRoute();
                const { loadContacts, addContact, updateContact, getContact } = useContacts();
                
                const form = reactive({
                    firstName: '',
                    lastName: '',
                    email: '',
                    phone: ''
                });

                onMounted(() => {
                    loadContacts();
                    if (props.isEdit) {
                        const existing = getContact(route.params.id);
                        if (existing) {
                            Object.assign(form, existing);
                        } else {
                            router.push('/');
                        }
                    }
                });

                const handleSubmit = () => {
                    if (!form.firstName || !form.lastName || !form.email) return;

                    if (props.isEdit) {
                        updateContact({ ...form });
                        router.push('/contact/' + form.id);
                    } else {
                        const newId = addContact({ ...form });
                        router.push('/contact/' + newId);
                    }
                };

                return { form, handleSubmit };
            },
            template: `
                <div class="max-w-xl mx-auto">
                     <button @click="$router.back()" class="mb-4 text-sm text-gray-500 hover:text-indigo-600 flex items-center gap-1">
                        <i class="fa-solid fa-arrow-left"></i> Cancel
                    </button>
                    
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                            <i :class="isEdit ? 'fa-solid fa-pen-to-square text-indigo-500' : 'fa-solid fa-user-plus text-green-500'"></i>
                            {{ isEdit ? 'Edit Contact' : 'Create New Contact' }}
                        </h2>
                        
                        <form @submit.prevent="handleSubmit" class="space-y-5">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                                    <input v-model="form.firstName" required type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                                    <input v-model="form.lastName" required type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                                <input v-model="form.email" required type="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all">
                            </div>

                             <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number (Optional)</label>
                                <input v-model="form.phone" type="tel" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all">
                            </div>

                            <button type="submit" class="w-full py-3 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition-all transform active:scale-95 shadow-lg shadow-indigo-200">
                                {{ isEdit ? 'Update Contact' : 'Save Contact' }}
                            </button>
                        </form>
                    </div>
                </div>
            `
        };

        // --- Router Setup ---
        const routes = [
            { path: '/', component: Home },
            { path: '/contact/:id', component: ContactDetails },
            { path: '/add', component: ContactForm, props: { isEdit: false } },
            { path: '/edit/:id', component: ContactForm, props: { isEdit: true } },
        ];

        const router = createRouter({
            history: createWebHashHistory(),
            routes
        });

        const app = createApp({});
        app.use(router);
        app.mount('#app');
    </script>
</body>
</html>
